<h1>Edit "<%= @form.name %>"</h1>
<%= bootstrap_form_for @form do |f| %>
    <%= f.text_field :name %>
    <%= f.text_field :website, label: "Website/Property" %>
    <%= f.collection_check_boxes :outputs, Output.all, :id, :name%>
    <textarea class="form-control hidden" name="form[input_fields]" id="form_input_fields">
      </textarea>
    <div id='editor_holder'></div>
    <%= f.submit "Save" %>
<% end %>

<script>
  // Initialize the editor with a JSON schema
  var $output = document.getElementById('form_input_fields');
  var startval = [];
  <% if @form.id %>
  $.getJSON( "<%= form_path(@form) +'.json' %>", function( data ) {
    startval = data.input_fields;
    init_editor();
  });
  <% else %>
  init_editor();
  <% end %>

  function init_editor(){
    var editor = new JSONEditor(document.getElementById('editor_holder'), {
      // Enable fetching schemas via ajax
      ajax: true,

      // The schema for the editor
      schema: {
        $ref: "<%= asset_path('inputfields.json') %>",
        format: "grid"
      },
      theme: 'bootstrap3',
      disable_properties: true,
      <% if @form.id %>
      // Seed the form with a starting value
      startval: startval
      <% end %>
    });
    editor.on('change', function () {
      var json = editor.getValue();

      $output.value = JSON.stringify(json, null, 2);
    });
  }


</script>